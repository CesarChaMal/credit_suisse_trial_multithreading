define(["require","jquery","console","videoblock","youtube"],function(require){"use strict";function parsePage(){$ignoreSelectors=$(".download-section");var $iframes=$(".content-block-item iframe");return $iframes.each(function(idx,iframe){ContentBlockItem.iframes.push(iframe);var processedIframeOrNull=parseIframe(iframe);null==processedIframeOrNull?ContentBlockItem.iframesSkipped.push(iframe):ContentBlockItem.iframesProcessed.push(iframe)}),console.log("Processed (modified) iframes: ",ContentBlockItem.iframesProcessed),ContentBlockItem.iframesProcessed}function getIframeHtml(iframeSrc){var src="undefined"==typeof iframeSrc?"":iframeSrc,$newIframe=$('<iframe allowfullscreen frameborder="0" style="border: 1px solid rgba(128,128,128,0.5);">');$newIframe.attr("src",src);var html=$newIframe.prop("outerHTML");return delete $newIframe[0],html}function parseIframe(iframe){var $iframe=$(iframe),src=$iframe.attr("src"),groupName='iframe decisions for "'+src+'"';console.groupCollapsed(groupName),console.log("ContentBlockItem: Looking at iframe with src = \n    '"+src+"'"),console.log("ContentBlockItem: \n    - peering for magic attribute `__contentblockitem_parsed`, \n    - then checking to see if a parent element has one of these \n          classes applied: [.mediablock, .youtubeblock, .videoblock],\n    - then checking if we are on the downloads page... \n    - then checking if the src contains magic words... \n    ..all of which would exclude it from further processing.");$iframe.attr("__contentblockitem_parsed");try{console.debug($iframe.stylesheet.rules.toString())}catch(e){}if("undefined"!=typeof $iframe.attr("__contentblockitem_parsed")||0===src.length||$iframe.parents(".mediablock").length||$ignoreSelectors.length)return console.info("ContentBlockItem: Skipping over this iframe. (",$iframe[0],")"),void console.groupEnd();$iframe.attr("__contentblockitem_parsed","1");var youtubeMatch=src.match(/youtube\.com/gi);if(null===youtubeMatch){var mediablockHtml='<div class="mediablock">\t<div class="layout-wrapper">\t <div class="mediablock__content">\t'+getIframeHtml(src)+"\t </div>\t</div></div>",$mediablock=$(mediablockHtml);$iframe.replaceWith($mediablock);var videoblock=new Videoblock;ContentBlockItem.videoBlocks.push(videoblock),console.groupEnd(groupName),console.log("replaced an iframe with src=",src,"with a mediablock:",$mediablock," videoblock: ",videoblock)}else{$iframe.parents(".videoblock").length&&$iframe.parents(".videoblock:first").replaceWith($iframe);var youtubeDataContext=new YouTube.YouTubeDataContext($iframe),youtubeHtml='<div class="videoblock youtubeblock">    <div class="layout-wrapper">        <div class="videoblock__content">            <div class="videoblock__cover"></div>            <button class="videoblock__button" type="button">                <span>Play</span>            </button>        </div>    </div></div>',$youtubeblock=$(youtubeHtml);$iframe.replaceWith($youtubeblock),ContentBlockItem.youtubeBlocks.push($youtubeblock),console.groupEnd(groupName),console.log("replaced an iframe with (YouTube VideoID "+youtubeDataContext.videoId+") "),console.log("...with a videoblock:",$youtubeblock);var embedSrc="//www.youtube.com/embed/"+youtubeDataContext.videoId,embedSrcWithAutoplay=embedSrc+"?autoplay=1",$ytblockVideoblockContent=$youtubeblock.find(".videoblock__content");console.log("Youtubeblock -- attempting to get thumbnail for YT video "+youtubeDataContext.videoId),youtubeDataContext.getLargeThumbnail(function(imageSrc){console.log("Youtubeblock -- thumbnail ready for YT "+youtubeDataContext.videoId,imageSrc),$youtubeblock.find(".videoblock__cover").css({background:'url("'+imageSrc+'") no-repeat scroll center center / contain rgba(0, 0, 0, 0)'})},function(param1,param2,data){if(console.log("Youtubeblock -- failed to retrieve thumbnail for YT video ID ",youtubeDataContext.videoId),console.log("  ... onError arguments: ",arguments),"object"==typeof param2&&"fn"in param2){var message=param1,$jqXHR=param2;console.log("  ... message: ",message,"$jqXHR: ",$jqXHR,"data: ",data)}else{var defaultImage=param1,thumbnailError=param2;console.log("  ... defaultImage: ",defaultImage,"thumbnailError: ",thumbnailError,"data: ",data)}$ytblockVideoblockContent.html(getIframeHtml(embedSrc))},"/images/play_48.png"),$ytblockVideoblockContent.on("click",function(){$youtubeblock.find("div.videoblock__cover, button.videoblock__button").remove(),$ytblockVideoblockContent.html("").append($(getIframeHtml(embedSrcWithAutoplay)))})}}var $ignoreSelectors,$=require("jquery"),console=require("console"),Videoblock=require("videoblock"),ContentBlockItem={videoBlocks:[],youtubeBlocks:[],iframes:[],iframesProcessed:[],iframesSkipped:[],parsePage:parsePage};return ContentBlockItem.parsePage(),ContentBlockItem});